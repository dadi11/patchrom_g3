*** AbsListView.smali	2016-03-24 11:21:49.095329364 +0100
--- AbsListView.smali	2016-03-24 11:18:59.527329364 +0100
***************
*** 197,212 ****
  
  .field private mGlowPaddingRight:I
  
  .field private mIsChildViewEnabled:Z
  
  .field final mIsScrap:[Z
  
  .field private mLastAccessibilityScrollEventFromIndex:I
  
  .field private mLastAccessibilityScrollEventToIndex:I
  
  .field private mLastHandledItemCount:I
  
  .field private mLastPositionDistanceGuess:I
  
  .field private mLastScrollState:I
--- 201,226 ----
  
  .field private mGlowPaddingRight:I
  
+ .field mInertia:I
+ 
  .field private mIsChildViewEnabled:Z
  
  .field final mIsScrap:[Z
  
+ .field mIsShortList:Z
+ 
+ .field mIsTouching:Z
+ 
  .field private mLastAccessibilityScrollEventFromIndex:I
  
  .field private mLastAccessibilityScrollEventToIndex:I
  
  .field private mLastHandledItemCount:I
  
+ .field mLastPivotX:F
+ 
+ .field mLastPivotY:F
+ 
  .field private mLastPositionDistanceGuess:I
  
  .field private mLastScrollState:I
***************
*** 345,351 ****
  .end method
  
  .method public constructor <init>(Landroid/content/Context;)V
!     .locals 6
      .param p1, "context"    # Landroid/content/Context;
  
      .prologue
--- 365,371 ----
  .end method
  
  .method public constructor <init>(Landroid/content/Context;)V
!     .locals 7
      .param p1, "context"    # Landroid/content/Context;
  
      .prologue
***************
*** 607,612 ****
  
      iput v9, p0, Landroid/widget/AbsListView;->mDirection:I
  
      invoke-direct {p0}, Landroid/widget/AbsListView;->initAbsListView()V
  
      invoke-static {}, Ljava/lang/Thread;->currentThread()Ljava/lang/Thread;
--- 637,658 ----
  
      iput v9, p0, Landroid/widget/AbsListView;->mDirection:I
  
+     const/4 v9, 0x0
+ 
+     iput v9, p0, Landroid/widget/AbsListView;->mDownMotionY:I
+ 
+     const/4 v9, 0x0
+ 
+     iput v9, p0, Landroid/widget/AbsListView;->mInertia:I
+ 
+     const/4 v9, 0x0
+ 
+     iput-boolean v9, p0, Landroid/widget/AbsListView;->mIsTouching:Z
+ 
+     const/high16 v9, 0x3f800000    # 1.0f
+ 
+     iput v9, p0, Landroid/widget/AbsListView;->mScaleY:F
+ 
      invoke-direct {p0}, Landroid/widget/AbsListView;->initAbsListView()V
  
      invoke-static {}, Ljava/lang/Thread;->currentThread()Ljava/lang/Thread;
***************
*** 2362,2368 ****
  .end method
  
  .method private onTouchMove(Landroid/view/MotionEvent;)V
!     .locals 7
      .param p1, "ev"    # Landroid/view/MotionEvent;
  
      .prologue
--- 2419,2425 ----
  .end method
  
  .method private onTouchMove(Landroid/view/MotionEvent;)V
!     .locals 8
      .param p1, "ev"    # Landroid/view/MotionEvent;
  
      .prologue
***************
*** 2402,2407 ****
      float-to-int v3, v4
  
      .local v3, "y":I
      iget v4, p0, Landroid/widget/AbsListView;->mTouchMode:I
  
      packed-switch v4, :pswitch_data_0
--- 2459,2482 ----
      float-to-int v3, v4
  
      .local v3, "y":I
+     iget-boolean v5, p0, Landroid/widget/AbsListView;->mIsTouching:Z
+ 
+     if-nez v5, :cond_miui_0
+ 
+     invoke-static {p0, p1}, Landroid/widget/AbsListViewInjector;->initOnTouchDown(Landroid/widget/AbsListView;Landroid/view/MotionEvent;)V
+ 
+     :cond_miui_0
+     invoke-static {p0, v3}, Landroid/widget/AbsListViewInjector;->getPanSpeed(Landroid/widget/AbsListView;I)I
+ 
+     move-result v7
+ 
+     iput v7, p0, Landroid/widget/AbsListView;->mInertia:I
+ 
+     iget v7, p0, Landroid/widget/AbsListView;->mDownMotionY:I
+ 
+     sub-int v7, v3, v7
+ 
+     .local v7, "offset":I
      iget v4, p0, Landroid/widget/AbsListView;->mTouchMode:I
  
      packed-switch v4, :pswitch_data_0
***************
*** 2478,2491 ****
      .end local v0    # "motionView":Landroid/view/View;
      .end local v2    # "x":F
      :pswitch_2
      invoke-direct {p0, v3}, Landroid/widget/AbsListView;->scrollIfNeeded(I)V
  
      goto :goto_0
  
      nop
  
      :pswitch_data_0
!     .packed-switch 0x0
          :pswitch_1
          :pswitch_1
          :pswitch_1
--- 2553,2582 ----
      .end local v0    # "motionView":Landroid/view/View;
      .end local v2    # "x":F
      :pswitch_2
+     invoke-static {p0, v7}, Landroid/widget/AbsListViewInjector;->setListScaleIfNeeded(Landroid/widget/AbsListView;I)Z
+ 
+     move-result v4
+ 
+     if-eqz v4, :cond_miui_1
+ 
+     iput v3, p0, Landroid/widget/AbsListView;->mLastY:I
+ 
+     return-void
+ 
+     :cond_miui_1
      invoke-direct {p0, v3}, Landroid/widget/AbsListView;->scrollIfNeeded(I)V
  
      goto :goto_0
  
+     :pswitch_miui_0
+     iput v6, p0, Landroid/widget/AbsListView;->mInertia:I
+ 
+     goto :goto_0
      nop
  
      :pswitch_data_0
!     .packed-switch -0x1
!         :pswitch_miui_0
          :pswitch_1
          :pswitch_1
          :pswitch_1
***************
*** 10132,10137 ****
  
      .end local v1    # "child":Landroid/view/View;
      :cond_6
      iput v7, p0, Landroid/widget/AbsListView;->mLastY:I
  
      goto :goto_1
--- 10273,10288 ----
  
      .end local v1    # "child":Landroid/view/View;
      :cond_6
+     iget v8, p0, Landroid/widget/AbsListView;->mLastY:I
+ 
+     iget v10, p0, Landroid/widget/AbsListView;->mDownMotionY:I
+ 
+     sub-int/2addr v8, v10
+ 
+     sub-int v8, v7, v8
+ 
+     iput v8, p0, Landroid/widget/AbsListView;->mDownMotionY:I
+ 
      iput v7, p0, Landroid/widget/AbsListView;->mLastY:I
  
      goto :goto_1
